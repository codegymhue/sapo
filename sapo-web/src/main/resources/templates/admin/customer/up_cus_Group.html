<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi-VN" class="sapo-menu-expand sapo-menu-toggle-active">
<head>
    <th:block th:replace="/layout/header :: header"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/admin/css/customer/cus_group.css"/>
    <title>Cập Nhập Nhóm Khách Hàng</title>
    <link rel="stylesheet" href="/assets/admin/css/product/selectMenu.css">
    <link rel="stylesheet" href="/assets/admin/css/w3school/w3.css">
</head>
<body>
<th:block th:replace="/layout/menu :: menu"/>
<div class="MuiBox-root jss64 jss40">
    <div class="MuiBox-root jss23598 jss23594 ">
        <div class="MuiBox-root jss23599 jss10118">
            <div class="MuiBox-root jss10121"><a
                    class="MuiTypography-root MuiLink-root MuiLink-underlineNone jss23596 MuiTypography-colorSecondary"
                    href="/admin/customer_groups" style="display: flex">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                     style="width: 24px; height: 24px; margin-left: -9px; margin-right: 6px;">
                    <path d="M14.298 5.99 8.288 12l6.01 6.01 1.414-1.414L11.116 12l4.596-4.596-1.414-1.414Z"
                          fill="currentColor"></path>
                </svg>
                <h6 class="MuiTypography-root MuiTypography-subtitle1">Quay lại danh sách nhóm khách hàng</h6></a>
                <span hidden id="cusGrpId" th:text="${customerGroup.getId()}"></span>
            </div>
            <div class="MuiBox-root jss20296">
                <button id="btnSowModalDelete" class="hFrEkh btn deleBut"
                        fdprocessedid="mh7x7"><span class="">Xóa</span></button>
                <button id="btnUpdateCustomerGroup" class="btn btnUpdateCustomerGroup FmJDc"
                        fdprocessedid="ct2jmq"><span class="">Lưu</span></button>
            </div>
        </div>
    </div>
    <form action="#" >
        <div class="MuiBox-root jss23604 jss608">
            <div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-3">
                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-6">
                    <div class="MuiPaper-root jss23708 MuiPaper-elevation1 MuiPaper-rounded"
                         style="box-shadow: rgba(168, 168, 168, 0.25) 0px 2px 4px; height: 100%;">
                        <div class="MuiBox-root jss751 jss722 borderBottom">
                            <div class="MuiBox-root jss24250"><h6 class="MuiTypography-root MuiTypography-h6"
                                                                  style="margin-left: 24px;">Thông tin chung</h6>
                            </div>
                        </div>
                        <div class="MuiBox-root jss23712" style="padding: 16px 24px 24px;">
                            <div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-2">
                                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12">
                                    <div class="MuiFormControl-root jss754 MuiFormControl-fullWidth"><label
                                            class="MuiFormLabel-root MuiInputLabel-root jss755 MuiInputLabel-formControl MuiInputLabel-animated MuiInputLabel-shrink Mui-required Mui-required"
                                            data-shrink="true" for="upTitleGroup">Tên
                                        nhóm<span
                                                class="MuiFormLabel-asterisk MuiInputLabel-asterisk">&thinsp;*</span></label>
                                        <div class="MuiFormControl-root MuiTextField-root jss756 MuiFormControl-fullWidth"
                                             field="[object Object]" form="[object Object]">
                                            <div class="MuiInputBase-root MuiOutlinedInput-root MuiInputBase-fullWidth MuiInputBase-formControl">
                                                <input aria-invalid="false"
                                                       id="upTitleGroup"
                                                       placeholder="Nhập tên nhóm khách hàng" required=""
                                                       type="text"
                                                       aria-label="Without label"
                                                       class="MuiInputBase-input MuiOutlinedInput-input"
                                                       fdprocessedid="7i85i6" th:value="${customerGroup.title}">
                                                <fieldset aria-hidden="true"
                                                          class="jss823 MuiOutlinedInput-notchedOutline"
                                                          style="padding-left: 8px;">
                                                    <legend class="jss824" style="width: 0.01px;"><span>&ZeroWidthSpace;</span>
                                                    </legend>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12">
                                    <div class="MuiFormControl-root jss754 MuiFormControl-fullWidth"><label
                                            class="MuiFormLabel-root MuiInputLabel-root jss755 MuiInputLabel-formControl MuiInputLabel-animated MuiInputLabel-shrink"
                                            data-shrink="true" for="upCusGrpCode">Mã
                                        nhóm</label>
                                        <div class="MuiFormControl-root MuiTextField-root jss756 MuiFormControl-fullWidth"
                                             field="[object Object]" form="[object Object]">
                                            <div class="MuiInputBase-root MuiOutlinedInput-root MuiInputBase-fullWidth MuiInputBase-formControl">
                                                <input aria-invalid="false"
                                                       id="upCusGrpCode"
                                                       placeholder="Nhập mã nhóm khách hàng" type="text"
                                                       aria-label="Without label"
                                                       class="MuiInputBase-input MuiOutlinedInput-input" th:value="${customerGroup.cusGrpCode}"
                                                       fdprocessedid="sytfp">
                                                <fieldset aria-hidden="true"
                                                          class="jss823 MuiOutlinedInput-notchedOutline"
                                                          style="padding-left: 8px;">
                                                    <legend class="jss824" style="width: 0.01px;"><span>&ZeroWidthSpace;</span>
                                                    </legend>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12">
                                    <div class="MuiFormControl-root jss754 MuiFormControl-fullWidth"><label
                                            class="MuiFormLabel-root MuiInputLabel-root jss755 MuiInputLabel-formControl MuiInputLabel-animated MuiInputLabel-shrink"
                                            data-shrink="true" for="upDescription">Mô tả<span
                                            class="MuiTypography-root MuiTypography-caption"><svg
                                            viewBox="0 0 16 16"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="16" height="16"
                                            font-size="16"
                                            color="primary"
                                            style="font-size: 16px; cursor: pointer; margin-left: 6px;"><path
                                            d="M7.4 5v1.2h1.2V5H7.4ZM7.4 8.6V11h1.8V9.8h-.6V7.4H6.8v1.2h.6Z"
                                            fill="#0088FF"></path><path fill-rule="evenodd" clip-rule="evenodd"
                                                                        d="M8 2C4.688 2 2 4.688 2 8s2.688 6 6 6 6-2.688 6-6-2.688-6-6-6ZM3.2 8c0 2.646 2.154 4.8 4.8 4.8s4.8-2.154 4.8-4.8S10.646 3.2 8 3.2A4.806 4.806 0 0 0 3.2 8Z"
                                                                        fill="#0088FF"></path></svg></span></label>
                                        <div class="MuiFormControl-root MuiTextField-root jss757 jss756 MuiFormControl-fullWidth"
                                             field="[object Object]" form="[object Object]">
                                            <div class="MuiInputBase-root MuiOutlinedInput-root MuiInputBase-fullWidth MuiInputBase-formControl MuiInputBase-multiline MuiOutlinedInput-multiline">
                                                <textarea aria-invalid="false" id="upDescription"
                                                          rows="3" aria-label="Without label"
                                                          class="MuiInputBase-input MuiOutlinedInput-input MuiInputBase-inputMultiline MuiOutlinedInput-inputMultiline"
                                                          th:field="*{customerGroup.description}"
                                                >
                                                </textarea>
                                                <fieldset aria-hidden="true"
                                                          class="jss823 MuiOutlinedInput-notchedOutline"
                                                          style="padding-left: 8px;">
                                                    <legend class="jss824" style="width: 0.01px;"><span>&ZeroWidthSpace;</span>
                                                    </legend>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-6">
                    <div class="MuiPaper-root jss721 MuiPaper-elevation1 MuiPaper-rounded"
                         style="box-shadow: rgba(168, 168, 168, 0.25) 0px 2px 4px; height: 100%;">
                        <div class="MuiBox-root jss751 jss722 borderBottom">
                            <div class="MuiBox-root jss1769"><h6 class="MuiTypography-root MuiTypography-h6"
                                                                 style="margin-left: 24px;">Cài đặt nâng cao</h6>
                                <button class="MuiButtonBase-root MuiIconButton-root" tabindex="0" type="button"
                                        title="Cài đặt nâng cao" fdprocessedid="dazdea"
                                        style="padding: 0px; margin-left: 6px;"><span class="MuiIconButton-label"><svg
                                        viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"
                                        width="16"
                                        height="16" font-size="16" color="primary"
                                        style="font-size: 16px; cursor: pointer;"><path
                                        d="M7.4 5v1.2h1.2V5H7.4ZM7.4 8.6V11h1.8V9.8h-.6V7.4H6.8v1.2h.6Z"
                                        fill="#0088FF"></path><path fill-rule="evenodd" clip-rule="evenodd"
                                                                    d="M8 2C4.688 2 2 4.688 2 8s2.688 6 6 6 6-2.688 6-6-2.688-6-6-6ZM3.2 8c0 2.646 2.154 4.8 4.8 4.8s4.8-2.154 4.8-4.8S10.646 3.2 8 3.2A4.806 4.806 0 0 0 3.2 8Z"
                                                                    fill="#0088FF"></path></svg></span><span
                                        class="MuiTouchRipple-root"></span></button>
                            </div>
                        </div>
                        <div class="MuiBox-root jss23767" style="padding: 16px 24px 24px;">
                            <div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-2">
                                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12">
                                    <div class="MuiBox-root jss865 jss1785 item-box"
                                         style="border-top: 0; padding-top: 0;">
                                        <span class="MuiTypography-root title MuiTypography-subtitle1">
                                            Giá Mặc Định</span>
                                        <div class="dropdown jss1784">
                                            <div class="dropdown-toggle select-btn-pri"
                                                 type="button" data-bs-toggle="dropdown"
                                                 aria-expanded="false" style="
                                                        padding: 10px 0;
                                                        display: flex;
                                                        justify-content: space-between;
                                                        align-items: center; ">
                                                <span id="upPricingType" th:text="*{customerGroup.pricingPolicyId != null} ? *{customerGroup.getPricingPolicyId()} : 'Chọn giá mặc định' ">/span>
                                            </div>
                                            <ul class="dropdown-menu w-100 pricingPolicyIdCreate showAllPricingPolicy">
                                                <div style="border-bottom: 1px solid #e3e3e3;">
                                                    <li>
                                                        <div class="d-flex align-items-center">
                                                            <i class="fa-solid fa-magnifying-glass" style="margin-left: 16px;
                                                                   margin-right: 4px;
                                                                   color: #828282"></i>
                                                            <input id="inputSearchPri" style="margin: 2px"
                                                                   class="w-100 form-control border border-0"
                                                                   placeholder="Tìm kiếm hoặc nhập mới"/>
                                                        </div>
                                                    </li>
                                                    <li class="text-primary dropdown-item">
                                                        <button id="btnCreatePri" style="border: none; color: #2d9dff;padding: 10px;text-align: start;
                                                                     font-weight: 500;
                                                                     font-size: 14px" type="button"
                                                                class="bg-white w-100">
                                                            <i class="fa-solid fa-circle-plus"
                                                               style="margin: 0 9px"></i>Thêm mới
                                                            chính sách giá
                                                        </button>
                                                    </li>
                                                </div>
                                                <div id="showAllPricing">
                                                    <div  th:selected="*{customerGroup.getPricingPolicyId()}"></div>

                                                </div>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12">
                                    <div class="MuiFormControl-root jss754 MuiFormControl-fullWidth"><label
                                            class="MuiFormLabel-root MuiInputLabel-root jss755 MuiInputLabel-formControl MuiInputLabel-animated MuiInputLabel-shrink"
                                            data-shrink="true" for="upDiscount">Chiết khấu
                                        (%)</label>
                                        <div class="MuiFormControl-root MuiTextField-root jss756  MuiFormControl-fullWidth"
                                             field="[object Object]" form="[object Object]">
                                            <div class="MuiInputBase-root MuiOutlinedInput-root MuiInputBase-fullWidth MuiInputBase-formControl">
                                                <input aria-invalid="false"
                                                       id="upDiscount"
                                                       type="text" aria-label="Without label"
                                                       class="MuiInputBase-input MuiOutlinedInput-input" th:value="*{customerGroup.discount}"
                                                       style="text-align: right;" fdprocessedid="16ju8f">
                                                <fieldset aria-hidden="true"
                                                          class="jss823 MuiOutlinedInput-notchedOutline"
                                                          style="padding-left: 8px;">
                                                    <legend class="jss824" style="width: 0.01px;"><span>&ZeroWidthSpace;</span>
                                                    </legend>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12">
                                    <div class="MuiBox-root jss865 jss1785 item-box"
                                         style="border-top: 0; padding-top: 0;">
                                        <span class="MuiTypography-root title MuiTypography-subtitle1">
                                            Hình Thức Thanh Toán</span>
                                        <div class="dropdown jss1784">
                                            <div class="dropdown-toggle select-btn-pay"
                                                 type="button" data-bs-toggle="dropdown"
                                                 aria-expanded="false" style="
                                                        padding: 10px 0;
                                                        display: flex;
                                                        justify-content: space-between;
                                                        align-items: center; ">
                                                <span id="upPaymentType" th:text="*{customerGroup.paymentMethodId != null} ? *{customerGroup.paymentMethodId} : 'Chọn hình thức thanh toán' "></span>
                                            </div>
                                            <ul class="dropdown-menu w-100 categoryIdCreate showAllPaymentMethod" >
                                                <li>Chọn hình thức thanh toán</li>
                                                <div id="showAllPay">

                                                </div>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

</body>
<th:block th:replace="/admin/customer/model_dele_Cus_Grp::#modal_dele_cus_grp"/>
<th:block th:replace="/layout/script :: script"/>
<script src="/assets/admin/js/customer/customerGroup_App.js"></script>

<script>
    let pricingPolicy;
    let paymentMethod;
    const selectBtnPri = document.querySelector('.select-btn-pri');
    const selectBtnPay = document.querySelector('.select-btn-pay');
    let updateCusGroupParam = new CustomerGroup();
    // Lấy List Pricing Policy
    function getAllPricingPolicy(selectedPricing) {
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "http://localhost:8080/api/pricingPolicys"
        })
            .done((data) => {
                console.log(data);
                pricingPolicy = data;
                pricingPolicy.forEach(item => {
                    let isSelected = item === selectedPricing ? "selected" : "";
                    let str = `<li id="${item.id}" data-id="${item.id}" onclick="updateNamePri(${item.id})" class="${isSelected} catItem dropdown-item">${item.title}</li>`;
                    $(".showAllPricingPolicy #showAllPricing").append(str);
                });
            })
            .fail((jqXHR) => {

            })
    }
    //show select pricing policy
    function updateNamePri(id) {
        const arrayCat = pricingPolicy.filter(item => item.id === id)
        const val = arrayCat[0].title;
        console.log("is", id, val)
        selectBtnPri.firstElementChild.innerText = val;
        $("#upPricingType").data("id", id);
        let idValue = $("#upPricingType").data("id");
        console.log(idValue);
    }
    // Lấy List Payment Method
    function getAllPaymentMethod(selectedPayment) {
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "http://localhost:8080/api/admin/payment_methods"
        })
            .done((data) => {
                console.log(data);
                paymentMethod = data;
                paymentMethod.forEach(item => {
                    let isSelected = item === selectedPayment ? "selected" : "";
                    let str = `<li id="${item.id}" data-id="${item.id}" onclick="updateNamePay('${item.id}')" class="${isSelected} catItem dropdown-item">${item.title}</li>`;
                    $(".showAllPaymentMethod #showAllPay").append(str);
                });
            })
            .fail((jqXHR) => {

            })
    }
    //show select payment method
    function updateNamePay(id) {
        const arrayCat = paymentMethod.filter(item => item.id === id)
        const val = arrayCat[0].title;
        console.log("is", id, val)
        selectBtnPay.firstElementChild.innerText = val;
        $("#upPaymentType").data("id", id);
        let idValue = $("#upPaymentType").data("id");
        console.log(idValue);
    }

    $('#btnUpdateCustomerGroup').on('click', () => {
        let id = $("#cusGrpId").text();
            updateCusGroupParam.id = id;
            updateCusGroupParam.title = $('#upTitleGroup').val();
            updateCusGroupParam.cusGrpCode = $('#upCusGrpCode').val();
            updateCusGroupParam.description = $('#upDescription').val();
            updateCusGroupParam.pricing_policy_id = $('#upPricingType').data("id");
            updateCusGroupParam.discount = $('#upDiscount').val();
            updateCusGroupParam.payment_method_id = $('#upPaymentType').data("id");
             console.log(updateCusGroupParam)
        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "POST",
            "url": "http://localhost:8080/api/customer_groups/update",
            "data": JSON.stringify(updateCusGroupParam)
        })
            .done((data) => {
                console.log(data);
                let id = data.id;
                CustomerGroup_App.IziToast.showSuccessAlert('Sửa nhóm khách hàng thành công  !!!')

                setTimeout(() => {
                    window.location.href = "/admin/customer_groups/" + id;
                }, 1000)

            })
            .fail((jqXHR) => {
                console.log(jqXHR);
                if (jqXHR.responseJSON) {
                    $.each(jqXHR.responseJSON, (key, item) => {
                        CustomerGroup_App.IziToast.showErrorAlert(item);
                    })
                }

            })
    })

    function getCusGroupById(Id) {
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "http://localhost:8080/api/customer_groups" + "/" + Id
        })
            .done((data) => {
                customerGroup = data;
                console.log(customerGroup);
            })
            .fail((jqXHR) => {
                if (jqXHR.responseJSON) {
                    $.each(jqXHR.responseJSON, (key, item) => {
                        CustomerGroup_App.IziToast.showErrorAlert(item);
                    })
                }
            });
    }

    function showModalDelete() {
        $('#btnSowModalDelete').click(function () {
                // alert("modal dele")
            $('#modal_dele_cus_grp').modal('show');
        });
    }

    function deleteCusGrpHander() {
       let id = $("#cusGrpId").text();

        $('#btn_deleteCustomer').click(function () {
            // alert(" ok")
            console.log(id)
            return $.ajax({
                headers: {
                    "accept": "application/json",
                    "content-type": "application/json"
                },
                type: "DELETE",
                url: "http://localhost:8080/api/customer_groups/delete/" + id,
            })
                .done((data) => {
                    CustomerGroup_App.IziToast.showSuccessAlert("Xoá nhóm khách hàng thành công  !!! ");
                    $('#modal_dele_cus_grp').modal('hide');

                    setTimeout(() => {
                        window.location.href = "/admin/customer_groups";
                    }, 2500)
                })
                .fail((jqXHR) => {
                    $.each(jqXHR.responseJSON, (key, item) => {
                        CustomerGroup_App.IziToast.showErrorAlert(item);
                    })
                })
        })
    }

    deleteCusGrpHander();

    $(()=>{
        getAllPricingPolicy();
        getAllPaymentMethod();
        showModalDelete();
    })
</script>
</html>