<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi-VN" class="sapo-menu-expand sapo-menu-toggle-active">

<head>
    <title>Chi tiết khách hàng</title>

    <th:block th:replace="/admin/customer/layout/header"/>
    <link rel="stylesheet" href="/assets/admin/css/customer/info.css"/>
</head>
<body data-new-gr-c-s-check-loaded="14.1085.0">
<div id="root" style="overflow: auto;">
    <th:block th:replace="/layout/menu"/>

    <div class="jss64 jss40">
        <div class="jss638">
            <div class="jss641">
                <div class="jss644">
                    <a class="MuiTypography-root MuiLink-root MuiLink-underlineNone jss2114 MuiTypography-colorSecondary"
                       href="/admin/customers">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                             style="width: 24px; height: 24px; margin-left: -9px; margin-right: 6px;">
                            <path d="M14.298 5.99 8.288 12l6.01 6.01 1.414-1.414L11.116 12l4.596-4.596-1.414-1.414Z"
                                  fill="currentColor"></path>
                        </svg>
                        <h6 class="MuiTypography-root MuiTypography-subtitle1">Quay lại danh sách khách hàng</h6>
                    </a>
                </div>
                <div class="jss2119">
                    <button id="btnShowModalDelete" class="gYRFmk">
                        <span class="jcEYKF">
                            Xóa khách hàng
                        </span>
                    </button>
                    <button id="btn-create-voucher" class="FmJDc">
                        <span class="sc-papXJ ffDJGn">Tạo phiếu thu/chi</span>
                        <svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M7 10l5 5 5-5z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="jss646 jss608">
            <div class="jss609">
                <div class="jss612">
                    <h6 class="MuiTypography-root jss613" id="fullName">
                    </h6>
                </div>
                <!--                <div class="jss649 jss612"></div>-->
            </div>
            <div class="jss654 jss614">
                <div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-3">
                    <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-8">
                        <div class="jss758 jss615">
                            <div class="jss759 jss622 jss617">
                                <div class="jss760 jss621">
                                    <div class="jss761" style="display: flex;">
                                        <h6 class="MuiTypography-root MuiTypography-subtitle1"
                                            style="padding-right: 16px;">
                                            Thông tin cá nhân
                                        </h6>
                                        <div id="status">
                                            <span id="statusText"></span>
                                        </div>
                                    </div>
                                    <a class="jss2101 goToUpdate jsseh237">
                                        Cập nhật
                                    </a>
                                </div>
                                <div class="jss762 jss623">
                                    <div class="MuiGrid-root MuiGrid-container">
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss624 jss625 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Ngày sinh
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Giới tính
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Số điện thoại
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Email
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Nhân viên phụ trách
                                                </h6>
                                                <h6 class="MuiTypography-root  jss626 jss628 MuiTypography-subtitle1">
                                                    Tags
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss624 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="dob"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="gender"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="phone"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="email"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="employee"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="tags"></span>
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss624 jss625 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Nhóm khách hàng
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Mã khách hàng
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Mã số thuế
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Website
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 jss628 MuiTypography-subtitle1">
                                                    Mô tả
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss624  MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <a id="customerGroup" class="jsseh237"></a>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="code"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="tax"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="website"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss626 MuiTypography-subtitle1">
                                                    : <span id="description"></span>
                                                </h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="jss622 jss618">
                                <div class="jss621">
                                    <h6 class="MuiTypography-root MuiTypography-subtitle1">
                                        Thông tin mua hàng
                                    </h6>
                                    <a class="jss627" href="#">
                                        Chi tiết
                                    </a>
                                </div>
                                <div class="jss623">
                                    <div class="MuiGrid-root MuiGrid-container">
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss2098 jss2099 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Tổng chi tiêu
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Tổng SL đơn hàng
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Ngày cuối cùng mua hàng
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss2098 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="spendTotal">0</span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="orderTotal">0</span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="lastDateOrder">---</span>
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss2098 jss2099 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Tổng SL sản phẩm đã mua
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Tổng SL sản phẩm hoàn trả
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Công nợ hiện tại
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-3">
                                            <div class="MuiPaper-root jss2098 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="totalOrderProduct"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : 0
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="debtTotal">0</span>
                                                </h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-4">
                        <div class="jss2090">
                            <div class="jss2096 jss2093">
                                <div class="jss2095">
                                    <h6 class="MuiTypography-root MuiTypography-subtitle1">
                                        Thông tin gợi ý khi bán hàng
                                    </h6>
                                    <a class="jss2101 goToUpdate jsseh237">
                                        Cập nhật
                                    </a>
                                </div>
                                <div class="jss2097">
                                    <div class="MuiGrid-root MuiGrid-container">
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-7">
                                            <div class="MuiPaper-root jss2098 jss2099 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Chính sách giá mặc định
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Chiết khấu khách hàng
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 jss2102 MuiTypography-subtitle1">
                                                    Hình thức thanh toán mặc định
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-5">
                                            <div class="MuiPaper-root jss2098 MuiPaper-elevation1 MuiPaper-rounded">
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="defaultPricingPolicy"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="discount"></span>
                                                </h6>
                                                <h6 class="MuiTypography-root jss2100 MuiTypography-subtitle1">
                                                    : <span id="defaultPaymentMethod"></span>
                                                </h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--                            <div class="jss2467 jss2096 jss2094">-->
                            <!--                                <div class="jss2468 jss2095"><h6-->
                            <!--                                        class="MuiTypography-root MuiTypography-subtitle1">Thông tin tích điểm</h6>-->
                            <!--                                </div>-->
                            <!--                                <div class="jss2469 jss2097 jss2280">-->
                            <!--                                    <div class="jss2281">Khách hàng chưa được kích hoạt điểm và hạng thành viên-->
                            <!--                                    </div>-->
                            <!--                                    <button class="MuiButtonBase-root MuiButton-root MuiButton-outlined jss2282"-->
                            <!--                                            tabindex="0" type="button"><span-->
                            <!--                                            class="MuiButton-label">Kích hoạt ngay</span><span-->
                            <!--                                            class="MuiTouchRipple-root"></span></button>-->
                            <!--                                </div>-->
                            <!--                            </div>-->

                        </div>
                    </div>
                </div>
            </div>
            <div class="jss2103">
                <div class="jss2104">
                    <div class="gCRNBf">
                        <div id="scroller" class="fvZzuO jyZcwm1 jsseh238">
                            <div class="jyZcwm">
                                <!--                                <button id="histories" class="fJFgex">Lịch sử mua hàng</button>-->
                                <!--                                <button id="debts" class="fJFgex">Công nợ</button>-->
                                <button id="btnContacts" class="fJFgex">Liên hệ</button>
                                <button id="btnAddress" class="fJFgex">Địa chỉ</button>
                                <!--                                <button id="notes" class="fJFgex">Ghi chú</button>-->
                                <button id="btnCustomerGroups" class="fJFgex">Nhóm khách hàng</button>
                            </div>
                            <div class="jyZcwm2 hidden contactContainer">
                                <button id="btnShowModalCreateContact" class="kDDrLX">
                                    <svg class="MuiSvgIcon-root liFCEr" focusable="false" viewBox="0 0 24 24"
                                         aria-hidden="true">
                                        <path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z">
                                        </path>
                                    </svg>
                                    <span class="jaWHHK">Thêm mới liên hệ</span>
                                </button>
                            </div>
                            <div class="jyZcwm2 hidden addressContainer">
                                <button id="btnShowModalCreateAddress" class="kDDrLX">
                                    <svg class="MuiSvgIcon-root liFCEr" focusable="false" viewBox="0 0 24 24"
                                         aria-hidden="true">
                                        <path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z">
                                        </path>
                                    </svg>
                                    <span class="jaWHHK">Thêm mới địa chỉ</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="noContact">
                        <p>Không có dữ liệu liên hệ</p>
                    </div>

                    <div id="render_table">
                        <th:block th:replace="/admin/customer/layout/info_customer_tb::tbContact"/>
                        <th:block th:replace="/admin/customer/layout/info_customer_tb::tbCustomerGroup"/>
                        <th:block th:replace="/admin/customer/layout/info_customer_tb::tbAddress"/>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<th:block th:replace="/admin/customer/modal_delete_customer"/>
<th:block th:replace="/admin/customer/modal/contact/modal_createContact"/>
<th:block th:replace="/admin/customer/modal/contact/modal_editContact"/>
<th:block th:replace="/admin/customer/modal/contact/modal_deleteContact"/>
<th:block th:replace="/admin/customer/modal/contact/modal_resultDeleteContact"/>
<th:block th:replace="/admin/customer/modal/address/modal_createAddress"/>
<th:block th:replace="/admin/customer/modal/address/modal_editAddress"/>
<th:block th:replace="/admin/customer/modal/address/modal_deleteAddress"/>
<th:block th:replace="/admin/customer/modal/address/modal_resultDeleteAddress"/>
<th:block th:replace="/admin/customer/layout/script"/>

<script src="/assets/admin/js/customer/customerHistory.js"></script>
<script src="/assets/admin/js/customer/customer_app.js"></script>
<script>

    let currentCustomer = {};
    let contactParam = {};
    let createAddressParam = {};
    let addressDataTable = {};
    let contactDataTable = {};
    let updateAddressParam = {};
    let updateContactParam = {};
    const listAddressId = new Set();
    const listContactId = new Set();
    let tbContact = {};

    CustomerApp.page.elements.fullName = $("#fullName");
    CustomerApp.page.elements.status = $("#status");
    CustomerApp.page.elements.statusText = $("#statusText");
    CustomerApp.page.elements.dob = $("#dob");
    CustomerApp.page.elements.gender = $("#gender");
    CustomerApp.page.elements.phone = $("#phone");
    CustomerApp.page.elements.email = $("#email");
    CustomerApp.page.elements.employee = $("#employee");
    CustomerApp.page.elements.tags = $("#tags");
    CustomerApp.page.elements.customerGroup = $("#customerGroup");
    CustomerApp.page.elements.code = $("#code");
    CustomerApp.page.elements.tax = $("#tax");
    CustomerApp.page.elements.website = $("#website");
    CustomerApp.page.elements.description = $("#description");
    CustomerApp.page.elements.totalOrderProduct = $("#totalOrderProduct");
    CustomerApp.page.elements.defaultPricingPolicy = $("#defaultPricingPolicy");
    CustomerApp.page.elements.discount = $("#discount");
    CustomerApp.page.elements.defaultPaymentMethod = $("#defaultPaymentMethod");

    CustomerApp.page.elements.goToUpdate = $(".goToUpdate");

    CustomerApp.page.elements.btnShowModalDelete = $("#btnShowModalDelete");
    CustomerApp.page.elements.btnDeleteCustomer = $("#btnDeleteCustomer");
    CustomerApp.page.elements.btnShowModalCreateContact = $("#btnShowModalCreateContact");

    CustomerApp.page.elements.modalDeleteCustomer = $('#modal_delete_customer');
    CustomerApp.page.elements.modalCreateContact = $('#modalCreateContact');

    CustomerApp.page.elements.confirmText = $("#confirmText");

    CustomerApp.page.elements.btnCustomerGroups = $("#btnCustomerGroups");

    CustomerApp.page.elements.cgrCode = $("#cgrCode");

    //start customer group
    CustomerApp.page.elements.tbCustomerGroup = $("#tbCustomerGroup");
    //end customer group

    //start contact
    CustomerApp.page.elements.frmCreateContact = $("#frmCreateContact");
    CustomerApp.page.elements.frmEditContact = $("#frmEditContact");

    CustomerApp.page.elements.btnContacts = $("#btnContacts");

    CustomerApp.page.elements.tbContact = $("#tbContact");

    CustomerApp.page.dialogs.elements.fullNameCtCre = $("#fullNameCtCre");
    CustomerApp.page.dialogs.elements.phoneCtCre = $("#phoneCtCre");
    CustomerApp.page.dialogs.elements.emailCtCre = $("#emailCtCre");
    CustomerApp.page.dialogs.elements.faxCtCre = $("#faxCtCre");
    CustomerApp.page.dialogs.elements.positionCtCre = $("#positionCtCre");
    CustomerApp.page.dialogs.elements.departmentCtCre = $("#departmentCtCre");
    CustomerApp.page.dialogs.elements.noteCtCre = $("#noteCtCre");

    CustomerApp.page.dialogs.elements.btnCreateContact = $("#btnCreateContact");
    CustomerApp.page.elements.modalDeleteContact = $("#modalDeleteContact");
    CustomerApp.page.elements.modalResultDeleteContact = $("#modalResultDeleteContact");
    CustomerApp.page.elements.modalEditContact = $("#modalEditContact");
    //end contact

    //start address

    CustomerApp.page.elements.tbAddress = $("#tbAddress");
    CustomerApp.page.elements.frmCreateAddress = $("#frmCreateAddress");

    CustomerApp.page.elements.modalDeleteAddress = $("#modalDeleteAddress");
    CustomerApp.page.elements.modalCreateAddress = $("#modalCreateAddress");
    CustomerApp.page.elements.modalResultDeleteAddress = $("#modalResultDeleteAddress");

    CustomerApp.page.elements.btnAddress = $("#btnAddress");
    CustomerApp.page.elements.btnDeleteAddressContainer = $("#btnDeleteAddressContainer");

    CustomerApp.page.elements.districtUpdate = $("#districtUpdate");
    CustomerApp.page.elements.provinceUpdate = $("#provinceUpdate");
    CustomerApp.page.elements.wardUpdate = $("#wardUpdate");
    CustomerApp.page.elements.district = $("#district");
    CustomerApp.page.elements.province = $("#province");
    CustomerApp.page.elements.ward = $("#ward");
    //end address

    //start edit address
    CustomerApp.page.elements.frmEditAddress = $("#frmEditAddress");
    CustomerApp.page.elements.modalEditAddress = $("#modalEditAddress");

    CustomerApp.page.elements.provinceEdit = $("#provinceEdit");
    CustomerApp.page.elements.districtEdit = $("#districtEdit");
    CustomerApp.page.elements.wardEdit = $("#wardEdit");
    //end edit address

    //start contact
    CustomerApp.page.elements.btnContacts.click(() => {
        $("#noContact").removeClass('hidden').addClass('show');
        $(".contactContainer").removeClass('hidden').addClass('show');
        $('.addressContainer').addClass('hidden').removeClass('show');
        $('#tbAddress_wrapper').hide();
        // $('#tbContact_wrapper').removeClass('hidden').addClass('show');
        $('#tbContact_wrapper').show();
        $('#tbContact').show();
        $('#tbCustomerGroup').addClass('hidden').removeClass('show');
    })

    CustomerApp.page.commands.drawContactDataTable = () => {
        let id = +window.location.pathname.split('/')[3];

        if (currentCustomer.contacts.length === 0) {
            $("#tbContact").parent().addClass('hidden');
        } else {
            $("#tbContact").parent().removeClass('hidden').addClass('show');
            $("#noContact").removeClass('show').addClass('hidden');

            contactDataTable = CustomerApp.page.elements.tbContact.DataTable({
                dom: '<"top">Brt<"bottom"lifp><"clear">',
                processing: CustomerApp.dataTableDetails.language.processing,
                serverSide: true,
                searching: false,
                ordering: false,
                ajax: {
                    type: 'POST',
                    url: origin + `/api/customers/${id}/contacts/pagination`,
                    accept: 'application/json',
                    contentType: 'application/json',
                    data: function (d) {
                        return JSON.stringify(d);
                    }
                },
                language: CustomerApp.dataTableDetails.language,
                lengthMenu: [
                    [3, 20, 50, 100],
                    ['3', "20", "50", "100"]
                ],
                aoColumns: [
                    {
                        mData: 'id',
                        className: 'hYsv8 nYvd3',
                        target: 0
                    },
                    {
                        mData: 'fullName',
                        render: (data, type, row) => {
                            return row.fullName || '';
                        },
                        className: 's7uel',
                        target: 1
                    },
                    {
                        mData: 'phoneNumber',
                        render: (data, type, row) => {
                            return row.phoneNumber || '';
                        },
                        className: 's7uel',
                        target: 2
                    },
                    {
                        mData: 'email',
                        render: (data, type, row) => {
                            return row.email || '';
                        },
                        className: 's7uel',
                        target: 3
                    },
                    {
                        mData: 'position',
                        render: (data, type, row) => {
                            return row.position || '';
                        },
                        className: 's7uel',
                        target: 4
                    },
                    {
                        mData: 'department',
                        render: (data, type, row) => {
                            return row.department || '';
                        },
                        className: 's7uel',
                        target: 5
                    }
                ],
                columnDefs: [{
                    targets: 0,
                    render: function (data, type, row, meta) {
                        return `<input id=${row.id} type="checkbox"/>`
                    }
                }],
                fnCreatedRow: function (nRow, aData, iDataIndex) {
                    $(nRow).attr('id', aData.id);
                },
                initComplete: function (setting, json) {
                    CustomerApp.page.commands.deleteOneOrMoreCustomerContact();
                },
                drawCallback: () => {
                    CustomerApp.page.commands.deleteOneOrMoreCustomerContact();
                }
            })
        }
    }

    //start update contact
    CustomerApp.page.commands.editContact = () => {
        let customerId = +window.location.pathname.split('/')[3];
        let id = updateContactParam.id;
        console.log(id)
        updateContactParam.fullName = CustomerApp.getValue($("#fullNameContactEdit"));
        updateContactParam.phoneNumber = CustomerApp.getValue($("#phoneContactEdit"));
        updateContactParam.email = CustomerApp.getValue($("#emailContactEdit"));
        updateContactParam.fax = CustomerApp.getValue($("#faxContactEdit"));
        updateContactParam.position = CustomerApp.getValue($("#positionContactEdit"));
        updateContactParam.department = CustomerApp.getValue($("#departmentContactEdit"));
        updateContactParam.note = CustomerApp.getValue($("#noteContactEdit"));

        console.log(updateContactParam)

        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "PATCH",
            url: origin + `/api/customers/${customerId}/contact/${id}`,
            data: JSON.stringify(updateContactParam)
        })
            .done((data) => {
                console.log(data)
                CustomerApp.IziToast.showSuccessAlert('Cập nhật liên hệ thành công');
                CustomerApp.page.elements.modalEditContact.modal('hide');
                CustomerApp.page.elements.frmEditContact[0].reset();

                // CustomerApp.redrawDatatables(addressDataTable, origin + `/api/addresses`)
            })
            .fail((jqXHR) => {
                let errors = jqXHR.responseJSON.errors;

                errors.fullName ? CustomerApp.showErrorValidate($(".fullNameContactEdit-error.error"), errors.fullName) : '';

                errors.phoneNumber ? CustomerApp.showErrorValidate($(".phoneContactEdit-error.error"), errors.phoneNumber) : '';

                errors.email ? CustomerApp.showErrorValidate($(".emailContactEdit-error.error"), errors.email) : '';

                errors.fax ? CustomerApp.showErrorValidate($(".faxContactEdit-error.error"), errors.fax) : '';

                errors.position ? CustomerApp.showErrorValidate($(".positionContactEdit-error.error"), errors.position) : '';

                errors.department ? CustomerApp.showErrorValidate($(".departmentContactEdit-error.error"), errors.department) : '';

                errors.note ? CustomerApp.showErrorValidate($(".noteContactEdit-error.error"), errors.note) : '';

            })
    };

    let contactEditValidate = CustomerApp.page.elements.frmEditContact.validate({
        rules: {
            fullNameContactEdit: {
                maxlength: 255
            },
            phoneContactEdit: {
                isValidPhone: true,
            },
            emailContactEdit: {
                isValidEmail: true,
            },
            faxContactEdit: {
                isValidFax: true,
            },
            positionContactEdit: {
                maxlength: 50
            },
            departmentContactEdit: {
                maxlength: 255
            },
            noteContactEdit: {
                maxlength: 255
            }
        },
        messages: {
            fullNameContactEdit: {
                maxlength: "Họ tên không được vượt quá 255 ký tự"
            },
            positionContactEdit: {
                maxlength: 'Chức vụ không được vượt quá 50 ký tự'
            },
            departmentContactEdit: {
                maxlength: 'Bộ phận không được vượt quá 255 ký tự',
            },
            noteContactEdit: {
                maxlength: 'Ghi chú không được vượt quá 255 ký tự',
            }
        },
        errorElement: 'label',
        errorPlacement: (error, element) => {
            error ? $(".error.hidden").addClass('show').removeClass('hidden') : '';
            error.appendTo(element.parent().next("div"));
        },
        submitHandler: () => {
            CustomerApp.page.commands.editContact();
        },
        invalidHandler: () => {
            CustomerApp.IziToast.showErrorAlert('Vui lòng nhập đúng thông tin')
        }
    });

    $("#btnEditContact").click(() => {
        CustomerApp.page.elements.frmEditContact.trigger('submit');
    })

    $('.btnCloseEditContactModal').click(() => {
        CustomerApp.page.elements.frmEditContact[0].reset();
        contactEditValidate.resetForm();
        $(".error.show").addClass('hidden').removeClass('show')

        CustomerApp.setNullObj(updateContactParam, null);
    })

    $("#tbContact tbody").on('click', "tr td:not(:first-child)", function () {
        let customerId = +window.location.pathname.split('/')[3];
        let id = contactDataTable.row(this).data().id;

        updateContactParam.id = id;
        CustomerApp.page.elements.modalEditContact.modal('show');

        $.ajax({
            type: "GET",
            url: origin + `/api/customers/${customerId}/contact/${id}`
        })
            .done((data) => {
                let {fullName, phoneNumber, email, fax, position, department, note} = data;
                console.log(data)
                fullName ? $("#fullNameContactEdit").val(fullName) : '';
                phoneNumber ? $("#phoneContactEdit").val(phoneNumber) : '';
                email ? $("#emailContactEdit").val(email) : '';
                fax ? $("#faxContactEdit").val(fax) : '';
                position ? $("#positionContactEdit").val(position) : '';
                department ? $("#departmentContactEdit").val(department) : '';
                note ? $("#noteContactEdit").val(note) : '';

            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    });
    //end update contact
    //start delete one or more customer's contact
    CustomerApp.page.commands.deleteOneOrMoreCustomerContact = () => {
        $('#tbContact tbody tr td input[type="checkbox"]').change(function () {
            let checkboxLength = $('#tbContact tbody tr td input[type="checkbox"]').length;

            if ($(this).is(":checked")) {
                listContactId.add($(this).attr('id'))

                if (checkboxLength > listContactId.size && listContactId.size > 0)
                    $("#checkAllContacts").prop({indeterminate: true, checked: false})

                if (checkboxLength === listContactId.size && listContactId.size > 0)
                    $("#checkAllContacts").prop({indeterminate: false, checked: true});

                $("#tbContact thead tr th:not(:first-child)").addClass("hidden").removeClass('show');
                $("#contactActionContainer").remove();
                CustomerApp.page.commands.showTheadContactAction();

            } else {
                listContactId.delete($(this).attr('id'));

                $("#contactActionContainer").remove();
                CustomerApp.page.commands.showTheadContactAction();

                if (listContactId.size === 0)
                    $("#checkAllContacts").prop({indeterminate: false, checked: false})

                if (checkboxLength > listContactId.size && listContactId.size > 0)
                    $("#checkAllContacts").prop({indeterminate: true, checked: false})

                if (listContactId.size === 0) {
                    $("#tbContact thead tr th:not(:first-child)").addClass("show").removeClass('hidden');
                    $("#contactActionContainer").remove();
                }
            }
        })
    }

    CustomerApp.page.commands.checkAllContacts = () => {

        if ($("#checkAllContacts").is(":checked")) {
            $("#tbContact tbody tr td input").each(function () {
                $(this).prop("checked", true);
                listContactId.add($(this)[0].id);
            })
            $("#tbContact thead tr th:not(:first-child)").addClass("hidden").removeClass('show');
            CustomerApp.page.commands.showTheadContactAction();
        } else {
            $("#tbContact tbody tr td input").each(function () {
                $(this).prop("checked", false);
                listContactId.clear();
            })
            $("#tbContact thead tr th:not(:first-child)").addClass("show").removeClass('hidden');
            $("#contactActionContainer").remove();
            $("#contactActionContainer").addClass("hidden").removeClass('show');
        }
    };

    CustomerApp.page.commands.checkAllContacts();

    CustomerApp.page.commands.showTheadContactAction = () => {
        let str = `<th class="jss12735" id="contactActionContainer">
                        <div class="jyZcwm2">Đã chọn ${listContactId.size} liên hệ trên trang này</div>
                        <div class="jss12735">
                            <button type="button" onclick="CustomerApp.page.commands.showBtnDeleteContactContainer()"
                            class="vUaem">
                            Chọn thao tác
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            width="24" height="24" font-size="24" active="true" variant="filled"
                            class="sc-hHLeRK cDcJUH">
                                <path d="m7 9.5 5 5 5-5H7Z" fill="currentColor">
                                </path>
                            </svg>
                            </button>
                            <div id="btnDeleteContactContainer" class="dropdown-content mauWs">
                                <button type="button" class="vUaem showModalDeleteContact" id="showModalDeleteContact"
                                        onclick=CustomerApp.page.commands.showModalDeleteContact()>
                                    Xóa địa chỉ
                                </button>
                            </div>
                        </div>
                    </th>`;
        $("#tbContact thead tr").append(str);
    }

    $("#btnDeleteContact").click(() => {
        let customerId = +window.location.pathname.split('/')[3];
        const list = [...listContactId];
        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "DELETE",
            url: origin + `/api/customers/${customerId}/contacts`,
            data: JSON.stringify(list)
        })
            .done((data) => {
                console.log(data)
                let {namesDeleted, numberOfSuccess, numberOfFail, addressResult, idsDeleted} = data;

                CustomerApp.page.elements.modalDeleteContact.modal('hide');

                CustomerApp.page.elements.modalResultDeleteContact.modal('show');
                $("#numberContactsDeleted").text(numberOfSuccess);
                $("#numberContactsDeleteFail").text(numberOfFail);

                $.each(namesDeleted, (i, name) => {

                    let success = namesDeleted ? `<p class="kUvHa3">${name} - Đã được xóa thành công</p>` : '';
                    $("#deletedContactSucceedNames").prepend(success);
                })

                $("#showDeleteContactSuccessDetail").click(() => {
                    $("#deletedContactSucceedNames").toggleClass('show');
                })

                $("#showDeleteContactFailDetail").click(() => {
                    $("#deletedContactFailNames").toggleClass('show');
                })

                listContactId.clear();

                contactDataTable.rows(...idsDeleted).remove().draw();
            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    })

    $(".btnCloseResultDeleteAddress").click(() => {
        CustomerApp.page.elements.modalResultDeleteAddress.modal('hide');
        $("#frmResultDeleteAddress")[0].reset();
        $("#checkAllAddresses").prop({
            indeterminate: false,
            checked: false
        });
        $("#addressActionContainer").addClass('hidden').removeClass('show');
        $("#tbAddress thead tr th:not(:first-child)").addClass("show").removeClass('hidden');
        $("#tbAddress thead tr th:last-child").addClass("hidden").removeClass('show');
        CustomerApp.page.commands.deleteOneOrMoreCustomerAddress();
    })

    CustomerApp.page.commands.showModalDeleteContact = () => {
        $("#confirmContactText").text(`Bạn có chắc chắn muốn xóa ${listContactId.size} liên hệ được chọn? Thao tác này không thể khôi phục.`);
        CustomerApp.page.elements.modalDeleteContact.modal('show')
        $("#btnDeleteContactContainer").toggleClass('show');
    }

    CustomerApp.page.commands.showBtnDeleteContactContainer = () => {
        $("#btnDeleteContactContainer").toggleClass('show');
    }

    //end delete one or more customer's contact

    CustomerApp.page.dialogs.elements.btnCreateContact.click(() => {
        CustomerApp.page.elements.frmCreateContact.trigger('submit');
    })

    CustomerApp.page.commands.createContact = () => {
        let id = +window.location.pathname.split('/')[3];

        contactParam.fullName = CustomerApp.getValue(CustomerApp.page.dialogs.elements.fullNameCtCre);
        contactParam.phoneNumber = CustomerApp.getValue(CustomerApp.page.dialogs.elements.phoneCtCre);
        contactParam.email = CustomerApp.getValue(CustomerApp.page.dialogs.elements.emailCtCre);
        contactParam.fax = CustomerApp.getValue(CustomerApp.page.dialogs.elements.faxCtCre);
        contactParam.position = CustomerApp.getValue(CustomerApp.page.dialogs.elements.positionCtCre);
        contactParam.department = CustomerApp.getValue(CustomerApp.page.dialogs.elements.departmentCtCre);
        contactParam.note = CustomerApp.getValue(CustomerApp.page.dialogs.elements.noteCtCre);

        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "POST",
            url: origin + `/api/customers/${id}/contacts`,
            data: JSON.stringify(contactParam)
        })
            .done((data) => {
                console.log(data)
                $("#modalCreateContact").modal('hide');
                CustomerApp.IziToast.showSuccessAlert('Thêm mới liên hệ thành công');

                CustomerApp.page.elements.frmCreateContact[0].reset();

                let {fullName, phoneNumber, email, fax, position, department, note} = data;

                contactDataTable.row.add([fullName, phoneNumber, email, fax, position, department, note]).draw(false);

            })
            .fail((jqXHR) => {

                let errors = jqXHR.responseJSON.errors;
                errors.fullName ? CustomerApp.showErrorValidate($(".fullNameCtCre-error.error"), errors.fullName) : '';
                errors.phoneNumber ? CustomerApp.showErrorValidate($(".phoneCtCre-error.error"), errors.phoneNumber) : '';
                errors.email ? CustomerApp.showErrorValidate($(".emailCtCre-error.error"), errors.email) : '';
                errors.fax ? CustomerApp.showErrorValidate($(".faxCtCre-error.error"), errors.fax) : '';
                errors.position ? CustomerApp.showErrorValidate($(".positionCtCre-error.error"), errors.position) : '';
                errors.department ? CustomerApp.showErrorValidate($(".departmentCtCre-error.error"), errors.department) : '';
                errors.note ? CustomerApp.showErrorValidate($(".noteCtCre-error.error"), errors.note) : '';
            })
    }
    let contactCreateValidate = CustomerApp.page.elements.frmCreateContact.validate({
        rules: {
            fullNameCtCre: {
                required: true,
                maxlength: 255
            },
            phoneCtCre: {
                isValidPhone: true,
            },
            faxCtCre: {
                isValidFax: true,
            },
            emailCtCre: {
                isValidEmail: true,
            },
            positionCtCre: {
                maxlength: 50
            },
            departmentCtCre: {
                maxlength: 255
            },
            noteCtCre: {
                maxlength: 255
            }
        },
        messages: {
            fullNameCtCre: {
                required: 'Họ tên không được để trống',
                maxlength: "Họ tên không được vượt quá 255 ký tự"
            },
            positionCtCre: {
                maxlength: 'Chức vụ không được vượt quá 50 ký tự',
            },
            departmentCtCre: {
                maxlength: 'Bộ phận không được vượt quá 255 ký tự',
            },
            noteCtCre: {
                maxlength: 'Ghi chú không được vượt quá 255 ký tự',
            }
        },
        errorElement: 'label',
        errorPlacement: (error, element) => {
            error ? $(".error.hidden").addClass('show').removeClass('hidden') : '';
            error.appendTo(element.parent().next("div"));
        },
        submitHandler: () => {
            CustomerApp.page.commands.createContact();
        },
        invalidHandler: () => {
            CustomerApp.IziToast.showErrorAlert('Vui lòng nhập đúng thông tin')
        }
    });

    CustomerApp.page.commands.getCustomerInfo = () => {
        let id = +window.location.pathname.split('/')[3];

        return $.ajax({
            type: "GET",
            url: origin + `/api/customers/${id}`,
        })
            .done((data) => {
                currentCustomer = {...data}
                CustomerApp.page.elements.fullName.text(CustomerApp.page.commands.getValue(data.fullName));

                if (data.status === "AVAILABLE") {
                    CustomerApp.page.elements.status.addClass("hlxtkG");
                    CustomerApp.page.elements.statusText.text('Đang giao dịch');
                    CustomerApp.page.elements.statusText.addClass('gIZkwA')
                } else {
                    CustomerApp.page.elements.status.addClass("csJERM");
                    CustomerApp.page.elements.statusText.text('Ngừng giao dịch');
                    CustomerApp.page.elements.status.addClass('NccQLIN');
                }

                data.birthday
                    ? CustomerApp.page.elements.dob.text(CustomerApp.formatDatePattern(CustomerApp.page.commands.getValue(data.birthday)))
                    : CustomerApp.page.elements.dob.text('---');

                CustomerApp.page.elements.gender.text(CustomerApp.page.commands.getValue(data.gender));
                CustomerApp.page.elements.phone.text(CustomerApp.page.commands.getValue(data.phoneNumber));
                CustomerApp.page.elements.email.text(CustomerApp.page.commands.getValue(data.email));
                CustomerApp.page.elements.employee.text(CustomerApp.page.commands.getValue(data.employee.fullName));

                data.tags.length > 0
                    ? CustomerApp.page.elements.tags.text(data.tags)
                    : CustomerApp.page.elements.tags.text('---');

                CustomerApp.page.elements.customerGroup.text(CustomerApp.page.commands.getValue(data.group.title));
                CustomerApp.page.elements.code.text(CustomerApp.page.commands.getValue(data.customerCode));
                CustomerApp.page.elements.tax.text(CustomerApp.page.commands.getValue(data.taxCode));
                CustomerApp.page.elements.website.text(CustomerApp.page.commands.getValue(data.website));
                CustomerApp.page.elements.description.text(CustomerApp.page.commands.getValue(data.description));
                CustomerApp.page.elements.totalOrderProduct.text(CustomerApp.page.commands.getValue(data.quantityProductOrder));
                CustomerApp.page.elements.defaultPricingPolicy.text(CustomerApp.page.commands.getValue(data.group.pricingPolicy.title));
                CustomerApp.page.elements.discount.text(CustomerApp.page.commands.getValue(data.group.defaultDiscountRate));
                CustomerApp.page.elements.defaultPaymentMethod.text(CustomerApp.page.commands.getValue(data.group.paymentMethod.title));
            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    }

    $(".btnCloseCreateContactModal").click(() => {
        CustomerApp.page.elements.frmCreateContact[0].reset();
        contactCreateValidate.resetForm();
    })
    //end contact

    CustomerApp.page.commands.showCustomerGroup = () => {
        CustomerApp.page.elements.btnCustomerGroups.click(() => {
            $('#tbAddress_wrapper').hide();
            $('#tbContact_wrapper').hide();
            $('#noContact').addClass('hidden').removeClass('show');

            $('.contactContainer').addClass('hidden').removeClass('show');

            CustomerApp.page.elements.tbCustomerGroup.addClass('show').removeClass('hidden');
            $(".jyZcwm2.addressContainer").addClass('hidden').removeClass('show');

            CustomerApp.page.elements.tbAddress.addClass('hidden').removeClass('show');
            // CustomerApp.page.elements.tbAddress.DataTable().destroy();

            CustomerApp.page.elements.tbContact.addClass('hidden').removeClass('show');
            // CustomerApp.page.elements.tbContact.DataTable().destroy();

            let id = currentCustomer.id;

            $.ajax({
                type: "GET",
                url: origin + `/api/customer_groups/${id}/customer`
            })
                .done((data) => {
                    let groupId = data.id;
                    CustomerApp.page.elements.cgrCode.text(`${data.cusGrpCode}`)
                    $("#cgrTitle").text(`${data.title}`)
                    $("#cgrType").text(`${data.type}`)
                    $("#cgrNote").text(`${data.note || '---'}`)

                    CustomerApp.page.elements.cgrCode.click(() => {
                        window.open(`/admin/customer_groups/${groupId}`,
                            '_blank');
                    })
                })
                .fail((jqXHR) => {
                    console.log(jqXHR)
                })
        })
    }

    CustomerApp.page.commands.deleteCustomer = () => {
        CustomerApp.page.elements.btnDeleteCustomer.click(() => {
            let id = currentCustomer.id;
            $.ajax({
                headers: {
                    "accept": "application/json",
                    "content-type": "application/json"
                },
                type: "DELETE",
                url: origin + "/api/customers/" + id
            })
                .done(() => {
                    CustomerApp.IziToast.showSuccessAlert("Xoá khách hàng thành công");
                    CustomerApp.page.elements.modalDeleteCustomer.modal('hide');

                    setTimeout(() => {
                        window.location.href = "/admin/customers";
                    }, 2500)
                })
                .fail((jqXHR) => {
                    console.log(jqXHR)
                })
        })
    }

    CustomerApp.page.elements.btnShowModalDelete.click(() => {
        CustomerApp.page.elements.modalDeleteCustomer.modal('show');
        CustomerApp.page.elements.confirmText.text(`Bạn có chắc chắn muốn xóa khách hàng ${currentCustomer.fullName}? Thao tác này không thể khôi phục.`)
    });

    CustomerApp.page.elements.customerGroup.click(() => {
        window.open(`/admin/customer_groups/${currentCustomer.group.id}`, '_blank');
    })

    CustomerApp.page.elements.goToUpdate.click(() => {
        window.location.href = `/admin/customers/${currentCustomer.id}/edit`;
    })

    CustomerApp.page.commands.getValue = (value) => {
        return value || '---';
    }

    //start modal create contact
    CustomerApp.page.elements.btnShowModalCreateContact.click(() => {
        CustomerApp.page.elements.modalCreateContact.modal('show');
    })
    //end modal create contact

    //start address

    //start delete one customer's address

    CustomerApp.page.commands.deleteOneOrMoreCustomerAddress = () => {
        $('#tbAddress tbody tr td input[type="checkbox"]').change(function () {
            let checkboxLength = $('#tbAddress tbody tr td input[type="checkbox"]').length;

            if ($(this).is(":checked")) {
                listAddressId.add($(this).attr('id'))

                if (checkboxLength > listAddressId.size && listAddressId.size > 0)
                    $("#checkAllAddresses").prop({indeterminate: true, checked: false})

                if (checkboxLength === listAddressId.size && listAddressId.size > 0)
                    $("#checkAllAddresses").prop({indeterminate: false, checked: true});

                $("#tbAddress thead tr th:not(:first-child)").addClass("hidden").removeClass('show');
                $("#addressActionContainer").remove();
                CustomerApp.page.commands.showTheadAddressAction();

            } else {
                listAddressId.delete($(this).attr('id'));

                $("#addressActionContainer").remove();
                CustomerApp.page.commands.showTheadAddressAction();

                if (listAddressId.size === 0)
                    $("#checkAllAddresses").prop({indeterminate: false, checked: false})

                if (checkboxLength > listAddressId.size && listAddressId.size > 0)
                    $("#checkAllAddresses").prop({indeterminate: true, checked: false})

                if (listAddressId.size === 0) {

                    $("#tbAddress thead tr th:not(:first-child)").addClass("show").removeClass('hidden');
                    $("#addressActionContainer").remove();
                }
            }
        })
    }
    //end delete one customer's address

    //start edit address
    CustomerApp.page.commands.editAddress = () => {
        let id = updateAddressParam.id;
        console.log(id)
        updateAddressParam.fullName = CustomerApp.getValue($("#fullNameAddressEdit"));
        updateAddressParam.phoneNumber = CustomerApp.getValue($("#phoneAddressEdit"));
        updateAddressParam.line1 = CustomerApp.getValue($("#line1Edit"));
        updateAddressParam.email = CustomerApp.getValue($("#emailEdit"));
        updateAddressParam.zipCode = CustomerApp.getValue($("#zipCodeEdit"));

        getSelectedValue(CustomerApp.page.elements.provinceEdit, updateAddressParam.provinceId, updateAddressParam.provinceName);
        getSelectedValue(CustomerApp.page.elements.districtEdit, updateAddressParam.districtId, updateAddressParam.districtName);
        getSelectedValue(CustomerApp.page.elements.wardEdit, updateAddressParam.wardId, updateAddressParam.wardName);

        console.log(updateAddressParam)

        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "PATCH",
            url: origin + `/api/addresses/${id}`,
            data: JSON.stringify(updateAddressParam)
        })
            .done((data) => {
                console.log(data)
                CustomerApp.IziToast.showSuccessAlert('Cập nhật địa chỉ thành công');
                CustomerApp.page.elements.modalEditAddress.modal('hide');
                CustomerApp.page.elements.frmEditAddress[0].reset();

                CustomerApp.redrawDatatables(addressDataTable, origin + `/api/addresses`)
            })
            .fail((jqXHR) => {
                let errors = jqXHR.responseJSON.errors;

                if (errors.fullName)
                    CustomerApp.showErrorValidate($(".fullNameAddressEdit-error.error"), errors.fullName)

                if (errors.phoneNumber)
                    CustomerApp.showErrorValidate($(".phoneAddressEdit-error.error"), errors.phoneNumber)

                if (errors.line1)
                    CustomerApp.showErrorValidate($(".line1Edit-error.error"), errors.line1)

                if (errors.email)
                    CustomerApp.showErrorValidate($(".emailEdit-error.error"), errors.email)

                if (errors.zipCode)
                    CustomerApp.showErrorValidate($(".zipCodeEdit-error.error"), errors.zipCode)

            })
    };

    let addressEditValidate = CustomerApp.page.elements.frmEditAddress.validate({
        rules: {
            fullNameAddressEdit: {
                maxlength: 150
            },
            phoneAddressEdit: {
                isValidPhone: true,
            },
            line1Edit: {
                required: true,
                maxlength: 255
            },
            emailEdit: {
                isValidEmail: true,
            },
            zipCodeEdit: {
                maxlength: 255
            }
        },
        messages: {
            fullNameAddressEdit: {
                maxlength: "Họ tên không được vượt quá 150 ký tự"
            },
            line1Edit: {
                required: 'Địa chỉ không được để trống',
                maxlength: 'Địa chỉ không được vượt quá 255 ký tự'
            },
            zipCodeEdit: {
                maxlength: 'Mã bưu điện không được vượt quá 255 ký tự',
            }
        },
        errorElement: 'label',
        errorPlacement: (error, element) => {
            error ? $(".error.hidden").addClass('show').removeClass('hidden') : '';
            error.appendTo(element.next("div"));
        },
        submitHandler: () => {
            CustomerApp.page.commands.editAddress();
        },
        invalidHandler: () => {
            CustomerApp.IziToast.showErrorAlert('Vui lòng nhập đúng thông tin')
        }
    });

    $("#btnEditAddress").click(() => {
        CustomerApp.page.elements.frmEditAddress.trigger('submit');
    })

    CustomerApp.page.elements.provinceEdit.on('change', function () {
        updateAddressParam.provinceId = Number($(this).find(":selected").val())
            ? $(this).find(":selected").val()
            : undefined;
        updateAddressParam.provinceName = Number($(this).find(":selected").val())
            ? $(this).find(":selected").text()
            : undefined;

        $.ajax({
            type: "GET",
            url: "https://vapi.vnappmob.com/api/province/district/" + updateAddressParam.provinceId
        })
            .done((data) => {
                let {results} = data ? data : null;

                CustomerApp.page.elements.districtEdit.empty();

                let str = '<option value=0>Chọn Quận/Huyện</option>';

                CustomerApp.page.elements.districtEdit.append(str);
                $.each(results, (i, item) => {
                    let str = ` <option value="${item.district_id}">${item.district_name}</option>`;
                    CustomerApp.page.elements.districtEdit.append(str);
                })

                updateAddressParam.districtId = Number(CustomerApp.page.elements.districtEdit.find(":selected").val())
                    ? CustomerApp.page.elements.districtEdit.find(":selected").val()
                    : undefined;
                updateAddressParam.districtName = Number(CustomerApp.page.elements.districtEdit.find(":selected").val())
                    ? CustomerApp.page.elements.districtEdit.find(":selected").text()
                    : undefined;

                $.ajax({
                    type: "GET",
                    url: "https://vapi.vnappmob.com/api/province/ward/" + updateAddressParam.districtId
                })
                    .done((data) => {
                        let {results} = data ? data : null;
                        CustomerApp.page.elements.wardEdit.empty();
                        let str = '<option value=0>Chọn Phường/Xã</option>';

                        CustomerApp.page.elements.wardEdit.append(str);
                        $.each(results, (i, item) => {
                            let str = `<option value="${item.ward_id}">${item.ward_name}</option>`;
                            CustomerApp.page.elements.wardEdit.append(str);
                        });

                        updateAddressParam.wardId = Number(CustomerApp.page.elements.wardEdit.find(":selected").val())
                            ? CustomerApp.page.elements.wardEdit.find(":selected").val()
                            : undefined;
                        updateAddressParam.wardName = Number(CustomerApp.page.elements.wardEdit.find(":selected").val())
                            ? CustomerApp.page.elements.wardEdit.find(":selected").text()
                            : undefined;

                        CustomerApp.page.elements.wardEdit.on('change', function () {
                            updateAddressParam.wardId = Number($(this).find(":selected").val())
                                ? $(this).find(":selected").val()
                                : undefined;
                            updateAddressParam.wardName = Number($(this).find(":selected").val())
                                ? $(this).find(":selected").text()
                                : undefined;
                        })
                    })
                    .fail((jqXHR) => {
                        console.log(jqXHR);
                    })

                CustomerApp.page.elements.districtEdit.on('change', function () {
                    updateAddressParam.districtId = Number($(this).find(":selected").val())
                        ? $(this).find(":selected").val()
                        : undefined;
                    updateAddressParam.districtName = Number($(this).find(":selected").val())
                        ? $(this).find(":selected").text()
                        : undefined;

                    $.ajax({
                        type: "GET",
                        url: "https://vapi.vnappmob.com/api/province/ward/" + updateAddressParam.districtId
                    })
                        .done((data) => {
                            let {results} = data ? data : null;
                            CustomerApp.page.elements.wardEdit.empty();
                            let str = '<option value=0>Chọn Phường/Xã</option>';

                            CustomerApp.page.elements.wardEdit.append(str);
                            $.each(results, (i, item) => {
                                let str = `<option value="${item.ward_id}">${item.ward_name}</option>`;
                                CustomerApp.page.elements.wardEdit.append(str);
                            });

                            updateAddressParam.wardId = Number(CustomerApp.page.elements.wardEdit.find(":selected").val())
                                ? CustomerApp.page.elements.wardEdit.find(":selected").val()
                                : undefined;
                            updateAddressParam.wardName = Number(CustomerApp.page.elements.wardEdit.find(":selected").val())
                                ? CustomerApp.page.elements.wardEdit.find(":selected").text()
                                : undefined;

                            CustomerApp.page.elements.wardEdit.on('change', function () {
                                updateAddressParam.wardId = Number($(this).find(":selected").val())
                                    ? $(this).find(":selected").val()
                                    : undefined;
                                updateAddressParam.wardName = Number($(this).find(":selected").val())
                                    ? $(this).find(":selected").text()
                                    : undefined;
                                console.log(updateAddressParam.wardId)
                                console.log(updateAddressParam.wardName)
                            })
                        })
                        .fail((jqXHR) => {
                            console.log(jqXHR);
                        })
                })
            })
            .fail((jqXHR) => {
                console.log(jqXHR);
            })
    })

    $('.btnCloseEditAddressModal').click(() => {
        CustomerApp.page.elements.provinceEdit.empty();
        CustomerApp.page.elements.wardEdit.empty();
        CustomerApp.page.elements.districtEdit.empty();
        CustomerApp.page.elements.frmEditAddress[0].reset();
        addressEditValidate.resetForm();

        CustomerApp.setNullObj(updateAddressParam, null);
    })
    //end edit address

    $("#tbAddress tbody").on('click', " tr td:not(:first-child)", function () {
        let id = addressDataTable.row(this).data().id;

        updateAddressParam.id = id;
        CustomerApp.page.elements.modalEditAddress.modal('show');

        $.ajax({
            type: "GET",
            url: origin + `/api/addresses/${id}`
        })
            .done((data) => {
                let address = {...data};

                data.fullName ? $("#fullNameAddressEdit").val(data.fullName) : '';
                data.phoneNumber ? $("#phoneAddressEdit").val(data.phoneNumber) : '';
                data.line1 ? $("#line1Edit").val(data.line1) : '';
                data.email ? $("#emailEdit").val(data.email) : '';
                data.zipCode ? $("#zipCodeEdit").val(data.zipCode) : '';

                data.districtId ? CustomerApp.page.elements.districtEdit.val(data.districtId) : '';
                data.wardId ? CustomerApp.page.elements.wardEdit.val(data.wardId) : '';

                $.ajax({
                    type: "GET",
                    url: "https://vapi.vnappmob.com/api/province/"
                })
                    .done((data) => {
                        let {results} = data ? data : null;
                        let str = '<option value=0>Chọn Tỉnh/Thành phố</option>';

                        CustomerApp.page.elements.provinceEdit.append(str);

                        $.each(results, (i, item) => {
                            let row = `<option value="${item.province_id}">${item.province_name}</option>`;

                            CustomerApp.page.elements.provinceEdit.append(row);
                            if (address.provinceId === Number(item.province_id)) {
                                $("#provinceEdit option").prop('selected', true);
                            }
                        });
                    })
                    .fail((jqXHR) => {
                        console.log(jqXHR);
                    })

                $.ajax({
                    type: "GET",
                    url: "https://vapi.vnappmob.com/api/province/district/" + address.provinceId
                })
                    .done((data) => {
                        let {results} = data ? data : null;
                        let str = '<option value=0>Chọn Quận/Huyện</option>';

                        CustomerApp.page.elements.districtEdit.append(str);
                        $.each(results, (i, item) => {
                            let str = ` <option value="${item.district_id}">${item.district_name}</option>`;
                            CustomerApp.page.elements.districtEdit.append(str);
                            address.districtId === Number(item.district_id) ? $("#districtEdit option").prop('selected', true) : '';
                        })
                    })
                    .fail((jqXHR) => {
                        console.log(jqXHR);
                    })

                $.ajax({
                    type: "GET",
                    url: "https://vapi.vnappmob.com/api/province/ward/" + address.districtId
                })
                    .done((data) => {
                        let {results} = data ? data : null;
                        let str = '<option value=0>Chọn Phường/Xã</option>';

                        CustomerApp.page.elements.wardEdit.append(str);
                        $.each(results, (i, item) => {
                            let str = `<option value="${item.ward_id}">${item.ward_name}</option>`;
                            CustomerApp.page.elements.wardEdit.append(str);
                            address.wardId === Number(item.ward_id) ? $("#wardEdit option").prop('selected', true) : '';
                        });
                    })
                    .fail((jqXHR) => {
                        console.log(jqXHR);
                    })

            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    });

    let addressCreateValidate = CustomerApp.page.elements.frmCreateAddress.validate({
        rules: {
            fullNameAddressCreate: {
                maxlength: 150
            },
            phoneAddressCreate: {
                isValidPhone: true,
            },
            line1Create: {
                required: true,
                maxlength: 255
            },
            emailCreate: {
                isValidEmail: true,
            },
            zipCodeCreate: {
                maxlength: 255
            }
        },
        messages: {
            fullNameAddressCreate: {
                maxlength: "Họ tên không được vượt quá 150 ký tự"
            },
            line1Create: {
                required: 'Địa chỉ không được để trống',
                maxlength: 'Địa chỉ không được vượt quá 255 ký tự'
            },
            zipCodeCreate: {
                maxlength: 'Mã bưu điện không được vượt quá 255 ký tự',
            }
        },
        errorElement: 'label',
        errorPlacement: (error, element) => {
            error ? $(".error.hidden").addClass('show').removeClass('hidden') : '';
            error.appendTo(element.next("div"));
        },
        submitHandler: () => {
            CustomerApp.page.commands.createAddress();
        },
        invalidHandler: () => {
            CustomerApp.IziToast.showErrorAlert('Vui lòng nhập đúng thông tin')
        }
    });

    $.validator.addMethod("isValidPhone", function (value, element) {
        return this.optional(element) || /^$|[0-9]{8,15}$/i.test(value);
    }, "Số điện thoại không đúng định dạng");

    $.validator.addMethod("isValidFax", function (value, element) {
        return this.optional(element) || /^$|[0-9]{8,15}$/i.test(value);
    }, "Số fax không đúng định dạng");

    $.validator.addMethod("isValidEmail", function (value, element) {
        return this.optional(element) || /^$|[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i.test(value);
    }, "Email không đúng định dạng");

    $("#btnCreateAddress").click(() => {
        CustomerApp.page.elements.frmCreateAddress.trigger("submit");
    });

    CustomerApp.page.commands.createAddress = () => {
        let id = +window.location.pathname.split('/')[3];

        createAddressParam.fullName = CustomerApp.getValue($('#fullNameAddressCreate'));
        createAddressParam.phoneNumber = CustomerApp.getValue($('#phoneAddressCreate'));
        createAddressParam.line1 = CustomerApp.getValue($('#line1Create'));
        createAddressParam.email = CustomerApp.getValue($('#emailCreate'));
        createAddressParam.zipCode = CustomerApp.getValue($('#zipCodeCreate'));

        if (CustomerApp.page.elements.province.find(":selected").val() !== "0") {
            createAddressParam.provinceId = CustomerApp.page.elements.province.find(":selected").val();
            createAddressParam.provinceName = CustomerApp.page.elements.province.find(":selected").text();
            createAddressParam.districtName = CustomerApp.page.elements.district.find(":selected").text();
            createAddressParam.districtId = CustomerApp.page.elements.district.find(":selected").val();
            createAddressParam.wardName = CustomerApp.page.elements.ward.find(":selected").text();
            createAddressParam.wardId = CustomerApp.page.elements.ward.find(":selected").val();
        } else {
            createAddressParam.provinceId = undefined;
            createAddressParam.provinceName = undefined;
            createAddressParam.districtName = undefined;
            createAddressParam.districtId = undefined;
            createAddressParam.wardName = undefined;
            createAddressParam.wardId = undefined;
        }

        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "POST",
            "url": origin + `/api/addresses/${id}/customer`,
            "data": JSON.stringify(createAddressParam)
        })
            .done((data) => {
                CustomerApp.page.elements.modalCreateAddress.modal('hide');
                CustomerApp.IziToast.showSuccessAlert('Thêm mới địa chỉ thành công');

                CustomerApp.page.elements.frmCreateAddress[0].reset();

                let {id, phoneNumber, line1, wardName, districtName, provinceName, zipCode, email} = data;

                addressDataTable.row.add([id, phoneNumber, line1, wardName, districtName, provinceName, zipCode, email]).draw(false);
            })
            .fail((jqXHR) => {

                let errors = jqXHR.responseJSON.errors;
                errors.fullName ? CustomerApp.showErrorValidate($(".fullNameAddressCreate-error.error"), errors.fullName) : '';
                errors.phoneNumber ? CustomerApp.showErrorValidate($(".phoneAddressCreate-error.error"), errors.phoneNumber) : '';
                errors.line1 ? CustomerApp.showErrorValidate($(".line1Create-error.error"), errors.line1) : '';
                errors.email ? CustomerApp.showErrorValidate($(".emailCreate-error.error"), errors.email) : '';
                errors.zipCode ? CustomerApp.showErrorValidate($(".zipCodeCreate-error.error"), errors.zipCode) : '';
            })
    }

    CustomerApp.page.elements.btnAddress.click(() => {

        $('#tbAddress_wrapper').show();
        $('#tbContact_wrapper').hide();
        $('#noContact').addClass('hidden').removeClass('show');
        $('.contactContainer').addClass('hidden').removeClass('show');
        CustomerApp.page.elements.tbCustomerGroup.addClass('hidden').removeClass('show');
        $(".jyZcwm2.addressContainer").addClass('hidden').removeClass('show');

        CustomerApp.page.elements.tbContact.addClass('hidden').removeClass('show');
        // CustomerApp.page.elements.tbContact.DataTable().destroy();

        $('.addressContainer').removeClass('hidden').addClass('show');
        CustomerApp.page.elements.tbAddress.removeClass('hidden').addClass('show');

        CustomerApp.page.elements.tbAddress.addClass('show').removeClass('hidden');
    })

    CustomerApp.page.elements.drawAddressDatatable = () => {
        let id = +window.location.pathname.split('/')[3];

        addressDataTable = CustomerApp.page.elements.tbAddress.DataTable({
            dom: '<"top">Brt<"bottom"lifp><"clear">',
            processing: CustomerApp.dataTableDetails.language.processing,
            serverSide: true,
            searching: false,
            ordering: false,
            autoWidth: false,
            ajax: {
                type: 'POST',
                url: origin + `/api/addresses/${id}/customer/pagination`,
                accept: 'application/json',
                contentType: 'application/json',
                data: function (d) {
                    return JSON.stringify(d);
                }
            },
            rowId: 'id',
            language: CustomerApp.dataTableDetails.language,
            lengthMenu: [
                [20, 50, 100],
                ["20", "50", "100"]
            ],
            columns: [
                {
                    data: 'id',
                    target: 0
                },
                {
                    data: 'phoneNumber',
                    render: (data, type, row) => {
                        return row.phoneNumber || '';
                    },
                    target: 1,
                    className: 'LavuC'
                },
                {
                    data: 'line1',
                    render: (data, type, row) => {
                        return row.line1 || '';
                    },
                    target: 2,
                    className: 'BaviW'
                },
                {
                    data: 'wardName',
                    render: (data, type, row) => {
                        return row.wardName || '';
                    },
                    className: 'jYgve',
                },
                {
                    data: 'districtName',
                    render: (data, type, row) => {
                        return row.districtName || '';
                    },
                    className: 'jYgve',
                },
                {
                    data: 'provinceName',
                    render: (data, type, row) => {
                        return row.provinceName || '';
                    },
                    className: 'jYgve',
                },
                {
                    data: 'zipCode',
                    render: (data, type, row) => {
                        return row.zipCode || '';
                    },
                    className: 'jYgve',
                },
                {
                    data: 'email',
                    render: (data, type, row) => {
                        return row.email || '';
                    },
                    className: 'jYgve',
                }
            ],
            columnDefs: [
                {
                    targets: 0,
                    render: function (data, type, row, meta) {
                        return `<input id=${row.id} type="checkbox"/>`
                    }
                },
            ],
            fnCreatedRow: function (nRow, aData, iDataIndex) {
                $(nRow).attr('id', aData.id);
            },
            initComplete: function (setting, json) {
                CustomerApp.page.commands.deleteOneOrMoreCustomerAddress();
            },
            drawCallback: () => {
                CustomerApp.page.commands.deleteOneOrMoreCustomerAddress();
            }
        });
    }

    //start check all/uncheck all

    CustomerApp.page.commands.checkAllAddresses = () => {

        if ($("#checkAllAddresses").is(":checked")) {
            $("#tbAddress tbody tr td input").each(function () {
                $(this).prop("checked", true);
                listAddressId.add($(this)[0].id);
            })
            $("#tbAddress thead tr th:not(:first-child)").addClass("hidden").removeClass('show');
            CustomerApp.page.commands.showTheadAddressAction();
        } else {
            $("#tbAddress tbody tr td input").each(function () {
                $(this).prop("checked", false);
                listAddressId.clear();
            })
            $("#tbAddress thead tr th:not(:first-child)").addClass("show").removeClass('hidden');
            $("#addressActionContainer").remove();
            $("#addressActionContainer").addClass("hidden").removeClass('show');
        }
    };

    CustomerApp.page.commands.showTheadAddressAction = () => {
        let str = `<th class="jss12735" id="addressActionContainer">
                        <div class="jyZcwm2">Đã chọn ${listAddressId.size} địa chỉ trên trang này</div>
                        <div class="jss12735">
                            <button type="button" onclick="CustomerApp.page.commands.showBtnDeleteAddressContainer()"
                            class="vUaem">
                            Chọn thao tác
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                            width="24" height="24" font-size="24" active="true" variant="filled"
                            class="sc-hHLeRK cDcJUH">
                                <path d="m7 9.5 5 5 5-5H7Z" fill="currentColor">
                                </path>
                            </svg>
                            </button>
                            <div id="btnDeleteAddressContainer" class="dropdown-content mauWs">
                                <button type="button" class="vUaem showModalDeleteAddress" id="showModalDeleteAddress"
                                        onclick=CustomerApp.page.commands.showModalDeleteAddress()>
                                    Xóa địa chỉ
                                </button>
                            </div>
                        </div>
                    </th>`;
        $("#tbAddress thead tr").append(str);
    }

    $("#btnDeleteAddress").click(() => {
        let id = +window.location.pathname.split('/')[3];
        const list = [...listAddressId];
        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "DELETE",
            url: origin + `/api/addresses/${id}/customer-addresses`,
            data: JSON.stringify(list)
        })
            .done((data) => {
                let {namesDeleted, numberOfSuccess, numberOfFail, addressResult, message, idsDeleted} = data;

                CustomerApp.page.elements.modalDeleteAddress.modal('hide');

                CustomerApp.page.elements.modalResultDeleteAddress.modal('show');
                $("#numberAddressesDeleted").text(numberOfSuccess);
                $("#numberAddressesDeleteFail").text(numberOfFail);

                $.each(namesDeleted, (i, name) => {

                    let success = namesDeleted ? `<p class="kUvHa3">${name} - Đã được xóa thành công</p>` : '';
                    $("#deletedAddressSucceedNames").prepend(success);
                })

                let fail = addressResult ? `<p>${addressResult.line1} - address: Không thể xóa địa chỉ cuối cùng</p>` : '';
                $("#deletedFailNames").prepend(fail);

                $("#showDeleteSuccessDetail").click(() => {
                    $("#deletedAddressSucceedNames").toggleClass('show');
                })

                $("#showDeleteFailDetail").click(() => {
                    $("#deletedFailNames").toggleClass('show');
                })

                listAddressId.clear();

                addressDataTable.rows(...idsDeleted).remove().draw();
            })
            .fail((jqXHR) => {
                console.log(jqXHR)
            })
    })

    $(".btnCloseResultDeleteAddress").click(() => {
        CustomerApp.page.elements.modalResultDeleteAddress.modal('hide');
        $("#frmResultDeleteAddress")[0].reset();
        $("#deletedAddressSucceedNames").empty();
        $("#checkAllAddresses").prop({
            indeterminate: false,
            checked: false
        });
        $("#addressActionContainer").addClass('hidden').removeClass('show');
        $("#tbAddress thead tr th:not(:first-child)").addClass("show").removeClass('hidden');
        $("#tbAddress thead tr th:last-child").addClass("hidden").removeClass('show');
        CustomerApp.page.commands.deleteOneOrMoreCustomerAddress();
    })

    CustomerApp.page.commands.showModalDeleteAddress = () => {
        $("#confirmAddressText").text(`Bạn có chắc chắn muốn xóa ${listAddressId.size} địa chỉ được chọn? Thao tác này không thể khôi phục.`);
        CustomerApp.page.elements.modalDeleteAddress.modal('show')
        $("#btnDeleteAddressContainer").toggleClass('show');
    }

    CustomerApp.page.commands.showBtnDeleteAddressContainer = () => {
        $("#btnDeleteAddressContainer").toggleClass('show');
    }
    //end checkAll/deCheckAll


    $("#btnShowModalCreateAddress").click(() => {
        CustomerApp.page.elements.modalCreateAddress.modal('show');
    })

    CustomerApp.page.commands.getAllProvinces = () => {
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "https://vapi.vnappmob.com/api/province/"
        })
            .done((data) => {
                if (data.results.length === 0) {
                    let str = `<option value="0">Chọn Tỉnh/Thành Phố</option>`;
                    CustomerApp.page.elements.province.append(str);
                } else {
                    $.each(data.results, (i, item) => {
                        let str = `<option value="${item.province_id}">${item.province_name}</option>`;
                        CustomerApp.page.elements.province.append(str);
                        CustomerApp.page.elements.provinceUpdate.append(str);
                    });
                }
            })
            .fail((jqXHR) => {
                console.log(jqXHR);
            })
    }

    CustomerApp.page.commands.getAllDistrictsByProvinceId = (provinceId) => {
        CustomerApp.page.elements.district.empty();
        CustomerApp.page.elements.districtUpdate.empty();
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "https://vapi.vnappmob.com/api/province/district/" + provinceId
        })
            .done((data) => {
                if (data.results.length === 0) {
                    let str = `<option value="0">Chọn Quận/Huyện</option>`;
                    CustomerApp.page.elements.district.append(str);
                } else {
                    $.each(data.results, (i, item) => {
                        let str = ` <option value="${item.district_id}">${item.district_name}</option>`;
                        CustomerApp.page.elements.district.append(str);
                        CustomerApp.page.elements.districtUpdate.append(str);
                    })
                }
            })
            .fail((jqXHR) => {
                console.log(jqXHR);
            })
    }

    CustomerApp.page.commands.getAllWardsByDistrictId = (districtId) => {
        CustomerApp.page.elements.ward.empty();
        CustomerApp.page.elements.wardUpdate.empty();
        return $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "GET",
            url: "https://vapi.vnappmob.com/api/province/ward/" + districtId
        })
            .done((data) => {

                if (data.results.length === 0) {
                    let str = `<option value="0">Chọn Phường/Xã</option>`;
                    CustomerApp.page.elements.ward.append(str);

                } else {
                    $.each(data.results, (i, item) => {
                        let str = `<option value="${item.ward_id}">${item.ward_name}</option>`;
                        CustomerApp.page.elements.ward.append(str);
                        CustomerApp.page.elements.wardUpdate.append(str);
                    });
                }
            })
            .fail((jqXHR) => {
                console.log(jqXHR);
            })
    }

    CustomerApp.page.commands.getAllProvinces().then(() => {
        let provinceId = CustomerApp.page.elements.province.val();

        CustomerApp.page.commands.getAllDistrictsByProvinceId(provinceId).then(() => {

            let districtId = CustomerApp.page.elements.district.val();

            CustomerApp.page.commands.getAllWardsByDistrictId(districtId)

        });
    });

    CustomerApp.page.elements.province.on('change', () => {
        let provinceId = CustomerApp.page.elements.province.val();

        CustomerApp.page.commands.getAllDistrictsByProvinceId(provinceId).done(() => {
            let districtId = CustomerApp.page.elements.district.val();
            CustomerApp.page.commands.getAllWardsByDistrictId(districtId);
        })

        CustomerApp.page.elements.district.on('change', () => {
            let districtId = CustomerApp.page.elements.district.val();
            CustomerApp.page.commands.getAllWardsByDistrictId(districtId);
        })
    });

    CustomerApp.page.elements.provinceUpdate.on("change", () => {
        let provinceId = CustomerApp.page.elements.provinceUpdate.val();

        CustomerApp.page.commands.getAllDistrictsByProvinceId(provinceId).then(() => {
            let districtId = CustomerApp.page.elements.districtUpdate.val();
            CustomerApp.page.commands.getAllWardsByDistrictId(districtId);
        })
    })

    CustomerApp.page.elements.districtUpdate.on("change", () => {
        let districtId = CustomerApp.page.elements.districtUpdate.val();
        CustomerApp.page.commands.getAllWardsByDistrictId(districtId);
    });

    $('.btnCloseCreateAddressModal').click(() => {
        CustomerApp.page.elements.frmCreateAddress[0].reset();
        addressCreateValidate.resetForm();
    })
    //end address

    $('.fJFgex').on('click', function () {
        $('button').removeClass('active');
        $(this).addClass('active');
    });

    const getSelectedValue = (input, variable1, variable2) => {
        if (Number(input.find(':selected').val()) !== 0) {
            variable1 = input.find(':selected').val();
            variable2 = input.find(':selected').text();
        } else {
            variable1 = undefined;
            variable2 = undefined;
        }
    }

    $(() => {
        CustomerApp.page.commands.getCustomerInfo().then(() => {
            CustomerApp.page.commands.deleteCustomer();

            CustomerApp.page.commands.showCustomerGroup();
            CustomerApp.page.elements.drawAddressDatatable();
            CustomerApp.page.commands.drawContactDataTable();

            $('#btnContacts').trigger('click');
        });
    })

</script>
</html>